generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL") // 実行時（Vercel/開発）用：Neonの pooled を入れる
  directUrl = env("DIRECT_URL")   // migrate 用：Neonの direct を入れる
}

enum AuthorType {
  user
  ai
}

model Thread {
  id             String   @id @default(cuid())
  title          String
  createdAt      DateTime @default(now())
  expiresAt      DateTime
  lastActivityAt DateTime @default(now())
  lastGhostAt    DateTime?

  posts          Post[]

  @@index([expiresAt])
  @@index([lastActivityAt])
}

model Post {
  id        String     @id @default(cuid())
  content   String
  authorType AuthorType @default(user)
  createdAt DateTime   @default(now())
  expiresAt DateTime
  isGhost   Boolean    @default(false)

  thread    Thread     @relation(fields: [threadId], references: [id], onDelete: Cascade)
  threadId  String

  @@index([threadId, createdAt])
  @@index([expiresAt])
  @@index([isGhost])
}